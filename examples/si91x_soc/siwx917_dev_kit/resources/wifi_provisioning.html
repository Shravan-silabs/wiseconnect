<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Silabs Wi-Fi Network Provisioning</title>
<style><!--  -->
body {
font-family: Arial, sans-serif;
margin: 0;
padding: 0;
display: flex;
justify-content: center;
align-items: center;
height: 100vh;
background-color: #f0f0f0;
}
#scan-form {
text-align: center;
padding: 20px;
border: 1px solid #ccc;
border-radius: 8px;
background-color: #fff;
}
input[type="submit"] {
width: 100%;
padding: 10px;
margin: 10px 0;
border: none;
border-radius: 5px;
background-color: #007bff;
color: #fff;
cursor: pointer;
}
input[type="submit"]:hover {
background-color: #0056b3;
}
#heading {
margin-bottom: 20px;
width: 100%;
}
.form-row {
display: flex;
justify-content: space-between;
align-items: center;
margin: 10px 0;
}
.form-row label {
width: 100px;
text-align: right;
margin-right: 10px;
white-space: nowrap;
}
.form-row input,
.form-row select {
flex: 2;
}
#scan-results {
    text-align: center;
    padding: 20px;
    border: 1px solid #ccc;
    border-radius: 8px;
    background-color: #fff;
    margin-top: 20px;
}
#connect-button {
    margin-top: 20px;
}
#password-input {
    width: 93%;
    padding: 10px;
    margin: 10px 0;
    border: none;
    border-radius: 5px;
    font-size: 16px; /* Optional: You can adjust the font size */
}
</style>
</head>
<body>
<form id="scan-form" action="/scan" method="get">
<h3 id="heading">Silabs Wi-Fi Network Provisioning</h3>
<input type="submit" value="Scan">
<div id="scan-results"></div>
<input type="submit" value="Connect" id="connect-button">
<input type="password" placeholder="Enter password" id="password-input"> <!-- Added password input -->
</form>
<script>
document.getElementById('scan-form').addEventListener('submit', function (event) {
    event.preventDefault();
    var xhr = new XMLHttpRequest();
    xhr.open('GET', '/scan', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function() {
        if (xhr.status === 200) {
            var scanResults = JSON.parse(xhr.responseText);
            var scanResultsTable = document.createElement('table');
            scanResultsTable.style.borderCollapse = "collapse";
            scanResultsTable.style.width = "100%";

            // Clear existing table
            document.getElementById('scan-results').innerHTML = "";

            // Create table header
            var tableHeader = document.createElement('tr');
            var headerColumns = ["Select", "SSID", "Security Type", "Channel", "RSSI"];
            headerColumns.forEach(function(column) {
                var th = document.createElement('th');
                th.textContent = column;
                th.style.border = "1px solid #ccc";
                th.style.padding = "8px";
                th.style.backgroundColor = "#f0f0f0";
                tableHeader.appendChild(th);
            });
            scanResultsTable.appendChild(tableHeader);

            // Create table rows
            scanResults.scan_results.forEach(function(result) {
                var tableRow = document.createElement('tr');

                // Add select radio button
                var selectRadio = document.createElement('input');
                selectRadio.type = "radio";
                selectRadio.name = "selectedSSID";
                selectRadio.value = result.ssid;
                var selectRadioCell = document.createElement('td');
                selectRadioCell.appendChild(selectRadio);
                selectRadioCell.style.border = "1px solid #ccc"; // Added border style
                tableRow.appendChild(selectRadioCell);

                var rowData = [result.ssid, result.security_type, result.channel, result.rssi];
                rowData.forEach(function(data, index) {
                    var td = document.createElement('td');
                    td.textContent = data;
                    td.style.border = "1px solid #ccc";
                    td.style.padding = "8px";
                    td.setAttribute("name", "td-" + index); // Add unique name attribute
                    tableRow.appendChild(td);
                });
                scanResultsTable.appendChild(tableRow);
            });

            // Clear existing scan-results div
            var scanResultsDiv = document.getElementById('scan-results');
            scanResultsDiv.innerHTML = "";

            // Append the table to the scan-results div
            scanResultsDiv.appendChild(scanResultsTable);
        };
    };
    xhr.send();
});

document.getElementById('connect-button').addEventListener('click', function (event) {
    event.preventDefault();
    var selectedSSID = document.querySelector('input[name="selectedSSID"]:checked');
    if (selectedSSID) {
        var ssid = selectedSSID.value;
        var password = document.getElementById('password-input').value;
        var securityType = selectedSSID.parentElement.nextElementSibling.textContent; // Get the text content of the next sibling element
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/connect', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        var data = {
            ssid: ssid,
            ppassphrase: password,
            security_type: securityType
        };
        xhr.send(JSON.stringify(data));
        document.getElementById('scan-form').style.display = 'none'; // Hide the scan form
        document.getElementById('scan-results').innerHTML = 'Connecting ...'; // Show "Connecting ..." message
    } else {
        alert('Please select a network to connect.');
    }
});
</script>
</body>
</html>
